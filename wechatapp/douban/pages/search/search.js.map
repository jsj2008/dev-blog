{"version":3,"sources":["pages/search/search.js"],"names":["app","getApp","Page","data","page","size","subtitle","movies","search","loading","hasMore","handleLoadMore","setData","douban","find","then","d","subjects","length","title","concat","catch","console","error","e","handleSearch","detail","value","onLoad","onReady","onShow","onHide","onUnload","onPullDownRefresh","wechat","original","stopPullDownRefresh"],"mappings":";;AAAA;AACA,IAAMA,MAAMC,QAAZ;;AAEA;AACAC,KAAK;AACH;;;AAGAC,QAAM;AACJC,UAAM,CADF;AAEJC,UAAM,EAFF;AAGJC,cAAU,WAHN;AAIJC,YAAQ,EAJJ;AAKJC,YAAQ,EALJ;AAMJC,aAAS,KANL;AAOJC,aAAS;AAPL,GAJH;;AAcHC,gBAdG,4BAce;AAAA;;AAChB,QAAI,CAAC,KAAKR,IAAL,CAAUO,OAAf,EAAwB;;AAExB,SAAKE,OAAL,CAAa,EAAEN,UAAU,QAAZ,EAAsBG,SAAS,IAA/B,EAAb;;AAEA,WAAOT,IAAIa,MAAJ,CAAWC,IAAX,CAAgB,QAAhB,EAA0B,KAAKX,IAAL,CAAUC,IAAV,EAA1B,EAA4C,KAAKD,IAAL,CAAUE,IAAtD,EAA4D,KAAKF,IAAL,CAAUK,MAAtE,EACJO,IADI,CACC,aAAK;AACT,UAAIC,EAAEC,QAAF,CAAWC,MAAf,EAAuB;AACrB,cAAKN,OAAL,CAAa,EAAEN,UAAUU,EAAEG,KAAd,EAAqBZ,QAAQ,MAAKJ,IAAL,CAAUI,MAAV,CAAiBa,MAAjB,CAAwBJ,EAAEC,QAA1B,CAA7B,EAAkER,SAAS,KAA3E,EAAb;AACD,OAFD,MAEO;AACL,cAAKG,OAAL,CAAa,EAAEF,SAAS,KAAX,EAAkBD,SAAS,KAA3B,EAAb;AACD;AACF,KAPI,EAQJY,KARI,CAQE,aAAK;AACV,YAAKT,OAAL,CAAa,EAAEN,UAAU,QAAZ,EAAsBG,SAAS,KAA/B,EAAb;AACAa,cAAQC,KAAR,CAAcC,CAAd;AACD,KAXI,CAAP;AAYD,GA/BE;AAiCHC,cAjCG,wBAiCWD,CAjCX,EAiCc;AACf,QAAI,CAACA,EAAEE,MAAF,CAASC,KAAd,EAAqB;AACrB,SAAKf,OAAL,CAAa,EAAEL,QAAQ,EAAV,EAAcH,MAAM,CAApB,EAAb;AACA,SAAKQ,OAAL,CAAa,EAAEN,UAAU,QAAZ,EAAsBI,SAAS,IAA/B,EAAqCD,SAAS,IAA9C,EAAoDD,QAAQgB,EAAEE,MAAF,CAASC,KAArE,EAAb;;AAEA,SAAKhB,cAAL;AACD,GAvCE;;;AAyCH;;;AAGAiB,QA5CG,oBA4CO;AACR;AACD,GA9CE;;;AAgDH;;;AAGAC,SAnDG,qBAmDQ;AACT;AACD,GArDE;;;AAuDH;;;AAGAC,QA1DG,oBA0DO;AACR;AACD,GA5DE;;;AA8DH;;;AAGAC,QAjEG,oBAiEO;AACR;AACD,GAnEE;;;AAqEH;;;AAGAC,UAxEG,sBAwES;AACV;AACD,GA1EE;;;AA4EH;;;AAGAC,mBA/EG,+BA+EkB;AACnB,SAAKrB,OAAL,CAAa,EAAEL,QAAQ,EAAV,EAAcH,MAAM,CAApB,EAAb;AACA,SAAKO,cAAL,GACGI,IADH,CACQ;AAAA,aAAMf,IAAIkC,MAAJ,CAAWC,QAAX,CAAoBC,mBAApB,EAAN;AAAA,KADR;AAED;AAnFE,CAAL","file":"search.js","sourcesContent":["// 获取全局应用程序实例对象\nconst app = getApp()\n\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    page: 1,\n    size: 20,\n    subtitle: '请在此输入搜索内容',\n    movies: [],\n    search: '',\n    loading: false,\n    hasMore: false\n  },\n\n  handleLoadMore () {\n    if (!this.data.hasMore) return\n\n    this.setData({ subtitle: '加载中...', loading: true })\n\n    return app.douban.find('search', this.data.page++, this.data.size, this.data.search)\n      .then(d => {\n        if (d.subjects.length) {\n          this.setData({ subtitle: d.title, movies: this.data.movies.concat(d.subjects), loading: false })\n        } else {\n          this.setData({ hasMore: false, loading: false })\n        }\n      })\n      .catch(e => {\n        this.setData({ subtitle: '获取数据异常', loading: false })\n        console.error(e)\n      })\n  },\n\n  handleSearch (e) {\n    if (!e.detail.value) return\n    this.setData({ movies: [], page: 1 })\n    this.setData({ subtitle: '加载中...', hasMore: true, loading: true, search: e.detail.value })\n\n    this.handleLoadMore()\n  },\n\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad () {\n    // TODO: onLoad\n  },\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n    // TODO: onReady\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow () {\n    // TODO: onShow\n  },\n\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide () {\n    // TODO: onHide\n  },\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload () {\n    // TODO: onUnload\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    this.setData({ movies: [], page: 1 })\n    this.handleLoadMore()\n      .then(() => app.wechat.original.stopPullDownRefresh())\n  }\n})\n"]}